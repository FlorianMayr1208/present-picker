{% extends "base.html" %}

{% block title %}Admin - √úbersicht{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="display-5">Admin-Bereich</h1>
        <p class="lead text-muted">√úbersicht √ºber Destinationen und Aktivit√§ten</p>
        <div class="alert alert-info">
            <strong>Hinweis:</strong> Dies ist eine vereinfachte Version. Daten werden aus JSON-Dateien gelesen.
            Zum Bearbeiten √∂ffne <code>data/destinations.json</code> und <code>data/activities.json</code>.
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Destinationen</h5>
                <p class="display-4">{{ destinations|length }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Aktivit√§ten</h5>
                <p class="display-4">{{ total_activities }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5 class="card-title">‚åÄ pro Destination</h5>
                <p class="display-4">{{ (total_activities / destinations|length)|round(1) if destinations|length > 0 else 0 }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col">
        <h3 class="mb-3">Destinationen</h3>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Beschreibung</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    {% for destination in destinations %}
                    <tr>
                        <td>{{ destination.id }}</td>
                        <td><strong>{{ destination.name }}</strong></td>
                        <td>
                            <small class="text-muted">
                                {{ destination.description_short[:80] if destination.description_short else '-' }}
                                {% if destination.description_short and destination.description_short|length > 80 %}...{% endif %}
                            </small>
                        </td>
                        <td>
                            <a href="{{ url_for('admin_activities', destination_id=destination.id) }}"
                               class="btn btn-sm btn-info">
                                Aktivit√§ten anzeigen
                            </a>
                            <a href="{{ url_for('show_destination', id=destination.id) }}"
                               class="btn btn-sm btn-primary"
                               target="_blank">
                                Vorschau
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col">
        <div class="card bg-light">
            <div class="card-body">
                <h5 class="card-title">üí° Daten bearbeiten</h5>
                <p class="card-text">
                    Um Destinationen oder Aktivit√§ten hinzuzuf√ºgen, zu bearbeiten oder zu l√∂schen:
                </p>
                <ol>
                    <li>√ñffne <code>data/destinations.json</code> f√ºr Destinationen</li>
                    <li>√ñffne <code>data/activities.json</code> f√ºr Aktivit√§ten</li>
                    <li>Bearbeite die JSON-Dateien in einem Text-Editor</li>
                    <li>Speichere und lade die Seite neu</li>
                </ol>
                <p class="card-text">
                    <strong>Bilder:</strong> Verwende externe URLs (z.B. Unsplash, OneDrive Share-Links, etc.)
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Guide Section -->
<div class="row mt-5">
    <div class="col">
        <h2 class="mb-4">üìñ Ausf√ºhrliche Anleitung</h2>

        <!-- Tabs -->
        <ul class="nav nav-tabs" id="guideTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="destinations-tab" data-bs-toggle="tab" data-bs-target="#destinations-guide" type="button" role="tab">
                    Destinations.json
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="activities-tab" data-bs-toggle="tab" data-bs-target="#activities-guide" type="button" role="tab">
                    Activities.json
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="points-tab" data-bs-toggle="tab" data-bs-target="#points-guide" type="button" role="tab">
                    Punktesystem
                </button>
            </li>
        </ul>

        <div class="tab-content border border-top-0 p-4" id="guideTabContent">
            <!-- Destinations Guide -->
            <div class="tab-pane fade show active" id="destinations-guide" role="tabpanel">
                <h4>destinations.json - Struktur</h4>
                <p>Jede Destination hat folgende Felder:</p>

                <h5 class="mt-4">Beispiel: Slider-Modus (wie Portugal)</h5>
                <pre class="bg-dark text-light p-3 rounded"><code>{
  "id": 5,
  "name": "S√ºdspanien - Spanien",
  "description_short": "Sonne, Strand und andalusische Kultur",
  "image_cover": "https://images.unsplash.com/photo-1543783207-ec64e4d95325?w=800",
  "selection_mode": "slider"
}</code></pre>

                <h5 class="mt-4">Beispiel: Checkbox-Modus (wie Marrakesch)</h5>
                <pre class="bg-dark text-light p-3 rounded"><code>{
  "id": 6,
  "name": "Bali - Indonesien",
  "description_short": "Tropisches Paradies mit Tempeln und Reisterrassen",
  "image_cover": "https://images.unsplash.com/photo-1537996194471-e657df975ab4?w=800",
  "selection_mode": "checkboxes",
  "points_budget": 100
}</code></pre>

                <h5 class="mt-4">Feld-Erkl√§rungen</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Feld</th>
                            <th>Pflicht</th>
                            <th>Beschreibung</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>‚úÖ</td>
                            <td>Eindeutige Nummer (muss in activities referenziert werden)</td>
                        </tr>
                        <tr>
                            <td><code>name</code></td>
                            <td>‚úÖ</td>
                            <td>Name der Destination (z.B. "Paris - Frankreich")</td>
                        </tr>
                        <tr>
                            <td><code>description_short</code></td>
                            <td>‚úÖ</td>
                            <td>Kurze Beschreibung (1-2 S√§tze)</td>
                        </tr>
                        <tr>
                            <td><code>image_cover</code></td>
                            <td>‚úÖ</td>
                            <td>URL zum Titelbild (Unsplash empfohlen)</td>
                        </tr>
                        <tr>
                            <td><code>selection_mode</code></td>
                            <td>‚úÖ</td>
                            <td><code>"slider"</code> oder <code>"checkboxes"</code></td>
                        </tr>
                        <tr>
                            <td><code>points_budget</code></td>
                            <td>Nur bei checkboxes</td>
                            <td>Maximale Punkte (empfohlen: 100)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Activities Guide -->
            <div class="tab-pane fade" id="activities-guide" role="tabpanel">
                <h4>activities.json - Struktur</h4>

                <h5 class="mt-4">Beispiel: Slider-Modus Aktivit√§t</h5>
                <pre class="bg-dark text-light p-3 rounded"><code>{
  "id": 21,
  "destination_id": 5,
  "title": "Anreise & Unterkunft (5 N√§chte)",
  "description": "Flug nach M√°laga, Mietwagen, zentrale Unterkunft",
  "slider_level_min": 0,
  "slider_level_max": 5,
  "image_filename": "https://images.unsplash.com/photo-1543783207-ec64e4d95325?w=800"
}</code></pre>

                <h5 class="mt-4">Beispiel: Checkbox-Modus Aktivit√§t mit Sub-Items</h5>
                <pre class="bg-dark text-light p-3 rounded"><code>{
  "id": 22,
  "destination_id": 6,
  "title": "Tempel & Kultur",
  "description": "Entdecke die spirituelle Seite Balis",
  "image_filename": "https://images.unsplash.com/photo-1537996194471-e657df975ab4?w=800",
  "default_selected": false,
  "sub_items": [
    {
      "id": "22a",
      "title": "Tanah Lot Tempel",
      "description": "Ber√ºhmter Meerestempel bei Sonnenuntergang",
      "points": 15,
      "default_selected": false,
      "image_filename": "https://images.unsplash.com/photo-1555400038-63f5ba517a47?w=600"
    },
    {
      "id": "22b",
      "title": "Ubud Royal Palace",
      "description": "Historischer Palast mit traditionellen T√§nzen",
      "points": 12,
      "default_selected": false,
      "image_filename": "https://images.unsplash.com/photo-1528127269322-539801943592?w=600"
    }
  ]
}</code></pre>

                <h5 class="mt-4">Beispiel: Mandatory Items (0 Punkte, nicht abw√§hlbar)</h5>
                <pre class="bg-dark text-light p-3 rounded"><code>{
  "id": "23a",
  "title": "Flug nach Bali",
  "description": "Direktflug von Frankfurt",
  "points": 0,
  "default_selected": true,
  "mandatory": true,
  "image_filename": "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=600"
}</code></pre>

                <h5 class="mt-4">Beispiel: "Den Rest spontan" Option</h5>
                <pre class="bg-dark text-light p-3 rounded"><code>{
  "id": "24a",
  "title": "Den Rest spontan",
  "description": "Nutze alle verbleibenden Punkte flexibel vor Ort",
  "points": 0,
  "default_selected": false,
  "is_spontaneous": true,
  "image_filename": "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=600"
}</code></pre>

                <h5 class="mt-4">Feld-Erkl√§rungen: Haupt-Aktivit√§t</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Feld</th>
                            <th>Pflicht</th>
                            <th>Beschreibung</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>‚úÖ</td>
                            <td>Eindeutige Nummer</td>
                        </tr>
                        <tr>
                            <td><code>destination_id</code></td>
                            <td>‚úÖ</td>
                            <td>ID der zugeh√∂rigen Destination</td>
                        </tr>
                        <tr>
                            <td><code>title</code></td>
                            <td>‚úÖ</td>
                            <td>Kategorie-Name (z.B. "Essen & Kulinarik")</td>
                        </tr>
                        <tr>
                            <td><code>description</code></td>
                            <td>‚úÖ</td>
                            <td>Beschreibung der Kategorie</td>
                        </tr>
                        <tr>
                            <td><code>image_filename</code></td>
                            <td>‚ùå</td>
                            <td>URL zum Kategorie-Bild</td>
                        </tr>
                        <tr>
                            <td><code>default_selected</code></td>
                            <td>Nur checkboxes</td>
                            <td><code>true</code> oder <code>false</code></td>
                        </tr>
                        <tr>
                            <td><code>sub_items</code></td>
                            <td>Nur checkboxes</td>
                            <td>Array von Sub-Aktivit√§ten</td>
                        </tr>
                        <tr>
                            <td><code>slider_level_min</code></td>
                            <td>Nur slider</td>
                            <td>Ab welchem Level sichtbar (0-5)</td>
                        </tr>
                        <tr>
                            <td><code>slider_level_max</code></td>
                            <td>Nur slider</td>
                            <td>Bis welchem Level sichtbar (0-5)</td>
                        </tr>
                    </tbody>
                </table>

                <h5 class="mt-4">Feld-Erkl√§rungen: Sub-Items</h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Feld</th>
                            <th>Pflicht</th>
                            <th>Beschreibung</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>‚úÖ</td>
                            <td>Eindeutige ID (z.B. "22a", "22b")</td>
                        </tr>
                        <tr>
                            <td><code>title</code></td>
                            <td>‚úÖ</td>
                            <td>Name der Aktivit√§t</td>
                        </tr>
                        <tr>
                            <td><code>description</code></td>
                            <td>‚úÖ</td>
                            <td>Detaillierte Beschreibung</td>
                        </tr>
                        <tr>
                            <td><code>points</code></td>
                            <td>‚úÖ</td>
                            <td>Kostet X Punkte (0 f√ºr mandatory)</td>
                        </tr>
                        <tr>
                            <td><code>default_selected</code></td>
                            <td>‚úÖ</td>
                            <td><code>true</code> oder <code>false</code></td>
                        </tr>
                        <tr>
                            <td><code>image_filename</code></td>
                            <td>‚ùå</td>
                            <td>URL zum Aktivit√§ts-Bild</td>
                        </tr>
                        <tr>
                            <td><code>mandatory</code></td>
                            <td>‚ùå</td>
                            <td><code>true</code> = nicht abw√§hlbar</td>
                        </tr>
                        <tr>
                            <td><code>is_spontaneous</code></td>
                            <td>‚ùå</td>
                            <td><code>true</code> f√ºr "Rest spontan"</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Points System Guide -->
            <div class="tab-pane fade" id="points-guide" role="tabpanel">
                <h4>Punktesystem - Best Practices</h4>

                <h5 class="mt-4">Grundprinzip</h5>
                <ul>
                    <li><strong>Budget:</strong> Setze <code>points_budget</code> in destinations.json (empfohlen: 100)</li>
                    <li><strong>Basis:</strong> Flug, Unterkunft, Transfer = 0 Punkte (mandatory)</li>
                    <li><strong>Verteilung:</strong> Verteile restliche Punkte nach Wertigkeit</li>
                </ul>

                <h5 class="mt-4">Empfohlene Punktewerte</h5>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Kategorie</th>
                            <th>Punkte</th>
                            <th>Beispiele</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Basis (Mandatory)</td>
                            <td>0</td>
                            <td>Flug, Unterkunft, Transfer</td>
                        </tr>
                        <tr>
                            <td>Kleine Aktivit√§ten</td>
                            <td>8-12</td>
                            <td>Museum, Stadtf√ºhrung, lokales Essen</td>
                        </tr>
                        <tr>
                            <td>Mittlere Aktivit√§ten</td>
                            <td>15-20</td>
                            <td>Kochkurs, Bootstour, Special Dinner</td>
                        </tr>
                        <tr>
                            <td>Gro√üe Aktivit√§ten</td>
                            <td>25-30</td>
                            <td>Tagesausflug, Wassersport, Helikopter</td>
                        </tr>
                        <tr>
                            <td>Highlights</td>
                            <td>35-40</td>
                            <td>Ballonfahrt, Tauchkurs, VIP-Erlebnis</td>
                        </tr>
                    </tbody>
                </table>

                <h5 class="mt-4">Beispiel-Rechnung (Budget: 100 Punkte)</h5>
                <div class="alert alert-success">
                    <strong>Option A - Kultur-Fokus:</strong><br>
                    Alle Museen (40) + Essen-Paket (45) + Stadtf√ºhrung (10) = 95 Punkte ‚úÖ
                </div>
                <div class="alert alert-success">
                    <strong>Option B - Erlebnis-Fokus:</strong><br>
                    Ballonfahrt (35) + Bootstour (25) + Kochkurs (15) + Museum (12) = 87 Punkte ‚úÖ
                </div>
                <div class="alert alert-success">
                    <strong>Option C - Mix mit Spontan:</strong><br>
                    Tagesausflug (28) + Special Dinner (18) + Den Rest spontan (54) = 100 Punkte ‚úÖ
                </div>

                <h5 class="mt-4">Tipps</h5>
                <ul>
                    <li>‚úÖ Sorge daf√ºr, dass verschiedene Kombinationen m√∂glich sind</li>
                    <li>‚úÖ Teure Highlights sollten alleine ca. 30-40% des Budgets kosten</li>
                    <li>‚úÖ "Den Rest spontan" erm√∂glicht flexible Restverwendung</li>
                    <li>‚ùå Vermeide zu viele teure Items (sonst keine Auswahl m√∂glich)</li>
                    <li>‚ùå Vermeide zu viele billige Items (sonst wird's un√ºbersichtlich)</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
